# MindEaseHelp 架构整改计划（统一来源 / 去重 / 入口瘦身）

## 目标

- **单一真相（Single Source of Truth）**：计分/分级/分诊、CBT 建议、localStorage 存储逻辑只保留一份权威实现。
- **依赖方向清晰**：UI 层只依赖 `domain`（或经由 `app`/hook），不再混用 `utils` 与 `domain`。
- **入口组件变薄**：`App.tsx` 专注于页面组装与渲染；流程状态与派生数据集中在 `useAssessmentFlow`。
- **行为不变**：用户体验、结果展示、保存/恢复逻辑保持一致。

## 范围

- React 前端代码（`src/*`）
- 计分/CBT/存储/评估流程相关模块
- 关联单测与类型检查

## 不在范围（本次不做）

- 引入后端、账号体系、云端同步
- 大规模 UI/交互重做
- Zustand 全局状态（`useAppStore`）是否保留的最终决策（除非影响本次整改）

## 风险与约束

- 改动将触及多文件引用关系，需确保 `npm run check` 通过。
- 需避免“改一处漏一处”的逻辑漂移；整改后应保证导入路径统一。

---

## 执行步骤（按顺序落地）

### 1) 输出计划到 `docs/`（本文件）

- **完成标准**：计划文档已提交，包含步骤与验收标准。

### 2) 统一权威来源：以 `src/domain/assessment/*` 为准

- **动作**：
  - 将 `src/utils/scoring.ts` 改为 **re-export** `src/domain/assessment/scoring.ts`（移除重复实现）。
  - 将 `src/utils/cbt.ts` 改为 **re-export** `src/domain/assessment/cbt.ts`（移除重复实现）。
- **完成标准**：
  - 仓库中只存在一套计分/CBT 的业务实现；`utils` 仅作为兼容转发层（或后续删除）。

### 3) 组件侧统一导入：禁止 `utils`/`domain` 混用

- **动作**：
  - `components/views/Intro.tsx`、`components/features/ShareResult.tsx` 等文件的 severity 类型导入改为来自 `domain/assessment/scoring`。
  - 全局搜索，确认 UI 层不再从 `utils/scoring` 导入核心业务类型/函数。
- **完成标准**：
  - UI 组件的业务类型与常量导入路径一致。

### 4) 重构入口：`App.tsx` 使用 `useAssessmentFlow`

- **动作**：
  - `App.tsx` 移除本地 `localStorage` 读写/校验、计分/分级/分诊、CBT tips 生成等重复逻辑。
  - 使用 `src/app/assessment/useAssessmentFlow.ts` 提供的状态、派生值与动作。
- **完成标准**：
  - `App.tsx` 主要只做：渲染路由/步骤、组装 UI、提供少量展示用 helper（如 badge 样式/时间格式）。
  - 功能行为与现状一致（保存/恢复/清除历史、分诊提示、CBT 工具等）。

### 5) 验证与回归

- **动作**：执行 `npm run check`（typecheck + lint + test）。
- **完成标准**：CI 同等检查在本地通过；无新增 TypeScript 错误。

---

## 可选后续（不影响本次主线）

- 对齐 `README` 中的项目结构说明与 Node 版本要求。
- 决定是否移除未使用的 `useAppStore` / `core/types`，或落地实际使用场景（如历史记录页面）。
